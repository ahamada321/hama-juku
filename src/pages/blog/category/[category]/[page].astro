---
import Layout from '@src/layouts/Layout.astro';
import BlogSection from '@components/BlogSection.astro';
import { blogPosts } from '@src/data/BlogItems';
import HeadingPage from '@src/components/HeadingPage.astro';

export async function getStaticPaths() {
  const categories = Array.from(new Set(blogPosts.flatMap((post) => post.categories)));
  const paths: { params: { category: string; page: string } }[] = [];
  categories.forEach((category) => {
    const categoryPosts = blogPosts.filter((post) => post.categories.includes(category));
    const totalPages = Math.ceil(categoryPosts.length / 3);
    for (let page = 1; page <= totalPages; page++) {
      paths.push({ params: { category, page: page.toString() } });
    }
  });
  return paths;
}

const { category, page } = Astro.params;
const categoryPosts = blogPosts.filter((post) => post.categories.includes(category));
const postsPerPage = 3;
const currentPage = parseInt(page);
const totalPosts = categoryPosts.length;
const totalPages = Math.ceil(totalPosts / postsPerPage);
const start = (currentPage - 1) * postsPerPage;
const posts = categoryPosts.slice(start, start + postsPerPage);

if (!categoryPosts.length || !posts.length) {
  return Astro.redirect('/404');
}
---

<Layout title={`Category: ${category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ')}`}>
  <HeadingPage
        title={`Category: ${category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ')}`}
        description="Explore our insights on design trends, tips, and creative inspiration to elevate your projects." />
  <BlogSection
    posts={posts}
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl={`/blog/category/${category}/`}
  />
</Layout>